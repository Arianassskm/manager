document.addEventListener('DOMContentLoaded',()=>{function checkLoginCookie(){const cookies=document.cookie.split(';');const loginCookie=cookies.find(c=>c.trim().startsWith('login='));if(loginCookie){if(validateCookie(loginCookie)){window.location.href='index.php';return true}}return false}function validateCookie(cookie){const parts=cookie.split(':');if(parts.length===3){const[username,expiryTime,signature]=parts;if(parseInt(expiryTime,10)>Math.floor(Date.now()/1000){const expectedSignature=hash_hmac('sha256',username+expiryTime,'your_secret_key');return signature===expectedSignature}}return false}if(checkLoginCookie()){return}const loginBtn=document.getElementById('login');const registerBtn=document.getElementById('register');const formBox=document.getElementsByClassName('form-box')[0];const registerBox=document.getElementsByClassName('register-box')[0];const loginBox=document.getElementsByClassName('login-box')[0];loginBtn.addEventListener('click',()=>{formBox.style.transform='translateX(0%)';registerBox.classList.add('hidden');loginBox.classList.remove('hidden')});registerBtn.addEventListener('click',()=>{formBox.style.transform='translateX(80%)';loginBox.classList.add('hidden');registerBox.classList.remove('hidden')});function submitRegister(){const username=document.getElementById('registerUsername').value;const email=document.getElementById('registerEmail').value;const qq=document.getElementById('registerQQ').value;const password=document.getElementById('registerPassword').value;const confirmPassword=document.getElementById('registerConfirmPassword').value;if(password!==confirmPassword){alert('两次输入的密码不一致');return}const data={action:'register',username:username,password:password,email:email,qq:qq};fetch('api/function.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:new URLSearchParams(data).toString()}).then(response=>response.text()).then(result=>alert(result)).catch(error=>console.error('Error:',error))}function submitLogin(){const username=document.getElementById('loginUsername').value;const password=document.getElementById('loginPassword').value;const data={action:'login',username:username,password:password};fetch('api/function.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:new URLSearchParams(data).toString()}).then(response=>response.text()).then(result=>{if(result==='登录成功'){window.location.href='index.php'}else{alert(result)}}).catch(error=>console.error('Error:',error))}});

